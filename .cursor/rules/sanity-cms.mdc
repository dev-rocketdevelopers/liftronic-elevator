---
globs: **/sanity/**/*.ts,**/sanity/**/*.tsx
---

# Sanity CMS Integration Patterns

## Schema Definition
```typescript
// src/sanity/schemaTypes/products.ts
import { defineField, defineType } from "sanity";

export const productType = defineType({
  name: "product",
  title: "Products", 
  type: "document",
  fields: [
    defineField({
      name: "title",
      title: "Product Title",
      type: "string",
      validation: (Rule) => Rule.required(),
    }),
    // ... more fields
  ],
});
```
- Use `defineType` and `defineField` from Sanity
- Include validation rules where appropriate
- Add icons from `@sanity/icons` for better UX

## Data Fetching
```typescript
// src/sanity/utils/getProducts.ts
import { groq } from "next-sanity";
import { client } from "../lib/client";

export async function getProducts(): Promise<Product[]> {
  const query = groq`*[_type == "product"]{
    _id,
    title,
    description,
    tags[]->{
      _id,
      title,
      slug
    }
  }`;
  return client.fetch<Product[]>(query);
}
```
- Use GROQ for queries with `groq` template literal
- Include proper TypeScript return types
- Resolve references with `->` operator
- Destructure needed fields only

## Type Definitions
- Define interfaces in [typings.d.ts](mdc:typings.d.ts)
- Extend `SanityDocument` for base document properties
- Use `Reference<Type>` for referenced documents
- Include `_type` field for discriminated unions

## File Organization
- **Schema types**: `src/sanity/schemaTypes/`
- **Utilities**: `src/sanity/utils/` (data fetching functions)
- **Client config**: `src/sanity/lib/client.ts`
- **Studio config**: `sanity.config.ts` (root level)

## Common Patterns
- **References**: Use for linking between documents
- **Arrays**: For lists (tags, FAQs, features)
- **Objects**: For structured data (specifications)
- **Validation**: Add appropriate validation rules
- **Preview**: Configure preview display in Studio

## Studio Access
- Studio available at `/studio` route
- Configured in `src/app/studio/[[...tool]]/page.tsx`
- Separate from main site functionality